<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <link rel="icon" type="image/png" href="img/logo_icono.png" sizes="48x48" />
  <title>SunGEXP – Marketplace de Emprendedores</title>
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">
  <link href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.10.5/font/bootstrap-icons.css" rel="stylesheet">
  <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" rel="stylesheet" crossorigin="anonymous" referrerpolicy="no-referrer">
  <link href="styles/styles.css" rel="stylesheet">

 
</head>
<body>
  <header class="top-bar">
    <div class="container d-flex align-items-center justify-content-between">
      <div class="logo">
        <img src="img/logo.png" alt="SunGEXP" height="40">
      </div>
      <div class="search flex-grow-1 mx-3">
        <input type="text" class="form-control" placeholder="Buscar productos, marcas y más...">
      </div>
      <div class="actions d-flex align-items-center gap-3">
        <a href="register.html" class="action-link">Crea tu cuenta</a>
        <a href="login.html" class="action-link">Ingresa</a>
        <a href="catalogo.html" class="action-link">Mis Compras</a>
        <i class="fas fa-shopping-cart cart"></i>
      </div>
    </div>
  </header>

  <div id="carouselExampleAutoplaying" class="carousel slide" data-bs-ride="carousel">
    <div class="carousel-inner">
      <div class="carousel-item active">
        <img src="img/banner_shopper.jpg" class="d-block img-fluid w-100" alt="Banner comprador">
      </div>
      <div class="carousel-item position-relative">
        <img src="img/banner_seller.jpg" class="d-block img-fluid w-100" alt="Banner vendedor">
        <section id="btn-pub" class="portfolio-experiment position-absolute">
          <a href="register.html">
            <span class="text">Publícalo gratis</span>
            <span class="line -top"></span>
            <span class="line -right"></span>
            <span class="line -bottom"></span>
            <span class="line -left"></span>
          </a>
        </section>
      </div>
    </div>
    <button class="carousel-control-prev" type="button" data-bs-target="#carouselExampleAutoplaying" data-bs-slide="prev">
      <span class="carousel-control-prev-icon"></span><span class="visually-hidden">Anterior</span>
    </button>
    <button class="carousel-control-next" type="button" data-bs-target="#carouselExampleAutoplaying" data-bs-slide="next">
      <span class="carousel-control-next-icon"></span><span class="visually-hidden">Siguiente</span>
    </button>
  </div>

  <header id="hero" class="hero text-center text-white">
    <div class="overlay"></div>
    <div class="container content">
      <h1 class="display-4 fw-bold">Conecta con tus clientes locales</h1>
      <p class="lead">Regístrate como vendedor o usuario y comienza a experimentar SunGEXP.</p>
      <a href="#registro" class="btn btn-primary btn-lg me-2">Registrarse</a>
      <a href="#catalogo" class="btn btn-outline-light btn-lg">Ver Catálogo</a>
    </div>
  </header>

  <section id="registro">
    <div class="container">
      <h2 class="text-center section-title">Registro</h2>
      <ul class="nav nav-tabs justify-content-center mb-4">
        <li class="nav-item"><button class="nav-link active" data-bs-toggle="tab" data-bs-target="#user">Usuario</button></li>
        <li class="nav-item"><button class="nav-link" data-bs-toggle="tab" data-bs-target="#vendor">Vendedor</button></li>
      </ul>
      <div class="tab-content">
        <div class="tab-pane fade show active" id="user">
          <form action="/api/register_user.php" method="POST">
            <div class="row g-3">
              <div class="col-md-6"><input type="text" class="form-control" name="name" placeholder="Nombre completo" required></div>
              <div class="col-md-6"><input type="email" class="form-control" name="email" placeholder="Correo electrónico" required></div>
              <div class="col-md-6"><input type="password" class="form-control" name="password" placeholder="Contraseña" required></div>
              <div class="col-md-6"><input type="text" class="form-control" name="address" placeholder="Dirección"></div>
              <div class="col-md-6"><input type="text" class="form-control" name="phone" placeholder="Teléfono"></div>
            </div>
            <div class="text-center mt-4"><button class="btn btn-primary">Registrarse</button></div>
          </form>
        </div>
        <div class="tab-pane fade" id="vendor">
          <form action="/api/register_vendor.php" method="POST">
            <div class="row g-3">
              <div class="col-md-6"><input type="text" class="form-control" name="name" placeholder="Nombre completo" required></div>
              <div class="col-md-6"><input type="email" class="form-control" name="email" placeholder="Correo electrónico" required></div>
              <div class="col-md-6"><input type="password" class="form-control" name="password" placeholder="Contraseña" required></div>
              <div class="col-md-6"><input type="text" class="form-control" name="shop_name" placeholder="Nombre del Taller" required></div>
              <div class="col-md-6"><input type="text" class="form-control" name="region" placeholder="Región"></div>
              <div class="col-md-12"><textarea class="form-control" name="description" placeholder="Descripción" rows="3"></textarea></div>
            </div>
            <div class="text-center mt-4"><button class="btn btn-primary">Registrarse</button></div>
          </form>
        </div>
      </div>
    </div>
  </section>

  <section id="productos-vendedor" style="display:none">
    <div class="container">
      <h2 class="text-center section-title">Panel de Vendedor</h2>
      <form class="mb-4">
        <div class="row g-3 align-items-end">
          <div class="col-md-4"><input type="text" class="form-control" name="product_name" placeholder="Nombre" required></div>
          <div class="col-md-2"><input type="number" step="0.01" class="form-control" name="price" placeholder="Precio" required></div>
          <div class="col-md-2"><input type="number" class="form-control" name="stock" placeholder="Stock" required></div>
          <div class="col-md-2"><input type="text" class="form-control" name="category" placeholder="Categoría"></div>
          <div class="col-md-2 text-end"><button type="submit" class="btn btn-success">Agregar</button></div>
        </div>
      </form>
      <div class="table-responsive">
        <table class="table table-striped card p-3">
          <thead><tr><th>ID</th><th>Nombre</th><th>Precio</th><th>Stock</th><th>Categoría</th></tr></thead>
          <tbody id="productosTable"></tbody>
        </table>
      </div>
    </div>
  </section>

  <section id="catalogo">
    <div class="container">
      <h2 class="text-center section-title">Catálogo</h2>
      <div class="row g-4" id="catalogoProductos"></div>
    </div>
  </section>

  <section id="carrito">
    <div class="container">
      <h2 class="text-center section-title">Tu Carrito</h2>
      <div class="table-responsive card p-3">
        <table class="table">
          <thead><tr><th>Producto</th><th>Cant.</th><th>Precio</th><th>Total</th></tr></thead>
          <tbody id="carritoTable"></tbody>
        </table>
      </div>
      <div class="text-end mt-3"><button id="btnPagar" class="btn btn-primary btn-lg">Pagar</button></div>
    </div>
  </section>

  <footer id="contacto" class="py-4 text-center">
    <div class="container">
      <p>¿Tienes dudas? Escríbenos a <a href="mailto:soporte@sungexp.com">soporte@sungexp.com</a></p>
      <small>© 2025 SunGEXP. Todos los derechos reservados.</small>
    </div>
  </footer>

  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/gsap@3/dist/gsap.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/gsap@3/dist/ScrollTrigger.min.js"></script>
  <script>
  (function(){
    const API = 'https://20.11.51.152';
    const user = JSON.parse(localStorage.getItem('user')||'{}');
    // Panel vendedor si corresponde
    if(user.rol==='vendedor') document.getElementById('productos-vendedor').style.display = 'block';
    // Listar productos y catálogo
    fetch(`${API}/listar_productos.php`).then(r=>r.json()).then(j=>{
      if(j.status!=='success') return;
      // Catálogo
      const cat = document.getElementById('catalogoProductos');
      cat.innerHTML = '';
      j.data.forEach(p=>{
        const col = document.createElement('div');
        col.className = 'col-6 col-lg-4';
        col.innerHTML = `
          <div class="card h-100">
            <img src="${p.imagen_url||'img/default.jpg'}" class="card-img-top" alt="${p.nombre}">
            <div class="card-body d-flex flex-column">
              <h6 class="card-title">${p.nombre}</h6>
              <div class="mb-2"><span class="fw-bold">S/ ${p.precio.toFixed(2)}</span></div>
              <button class="btn btn-outline-primary mt-auto add-to-cart"
                data-id="${p.id_producto}" data-name="${p.nombre}" data-price="${p.precio}"
              >Agregar al carrito</button>
            </div>
          </div>`;
        cat.appendChild(col);
      });
      // Delegar click "Agregar al carrito"
      cat.addEventListener('click', e=>{
        if(!e.target.classList.contains('add-to-cart')) return;
        const btn = e.target;
        let cart = JSON.parse(localStorage.getItem('cart')||'[]');
        const item = {
          id_producto: btn.dataset.id,
          nombre:      btn.dataset.name,
          precio:      parseFloat(btn.dataset.price),
          cantidad:    1
        };
        const ex = cart.find(x=>x.id_producto==item.id_producto);
        ex ? ex.cantidad++ : cart.push(item);
        localStorage.setItem('cart', JSON.stringify(cart));
        renderCart();
      });
      // Panel vendedor: listar tabla y dar de alta
      if(user.rol==='vendedor'){
        const tb = document.getElementById('productosTable');
        j.data.filter(p=>p.id_vendedor==user.id_usuario).forEach(p=>{
          const tr = document.createElement('tr');
          tr.innerHTML = `<td>${p.id_producto}</td><td>${p.nombre}</td><td>${p.precio.toFixed(2)}</td><td>${p.stock}</td><td>${p.categoria}</td>`;
          tb.appendChild(tr);
        });
        document.querySelector('#productos-vendedor form').addEventListener('submit', e=>{
          e.preventDefault();
          const f = e.target;
          const data = {
            product_name: f.product_name.value,
            price:        parseFloat(f.price.value),
            stock:        parseInt(f.stock.value),
            category:     f.category.value,
            vendedor_id:  user.id_usuario
          };
          fetch(`${API}/add_product.php`, {
            method:'POST',
            headers:{'Content-Type':'application/json'},
            body: JSON.stringify(data)
          }).then(r=>r.json()).then(jt=>{
            alert(jt.status==='success' ? 'Producto agregado' : 'Error: '+jt.message);
            if(jt.status==='success') f.reset();
          });
        });
      }
    });

    // Carrito
    function renderCart(){
      const cart = JSON.parse(localStorage.getItem('cart')||'[]');
      const tb = document.getElementById('carritoTable');
      tb.innerHTML = '';
      cart.forEach(i=>{
        const tr = document.createElement('tr');
        tr.innerHTML = `<td>${i.nombre}</td><td>${i.cantidad}</td><td>${i.precio.toFixed(2)}</td><td>${(i.precio*i.cantidad).toFixed(2)}</td>`;
        tb.appendChild(tr);
      });
    }
    renderCart();

    document.getElementById('btnPagar').addEventListener('click', ()=>{
      if(!user.id_usuario){ alert('Debes iniciar sesión primero'); return; }
      const cart = JSON.parse(localStorage.getItem('cart')||'[]');
      if(!cart.length){ alert('Carrito vacío'); return; }
      const total = cart.reduce((a,b)=>a + b.precio*b.cantidad,0);
      fetch(`${API}/purchase.php`,{
        method:'POST',
        headers:{'Content-Type':'application/json'},
        body: JSON.stringify({
          id_cliente: user.id_usuario,
          total,
          items: cart.map(i=>({id_producto:i.id_producto,cantidad:i.cantidad}))
        })
      })
      .then(r=>r.json())
      .then(p=>{
        alert(p.status==='success' ? 'Compra registrada: #'+p.id_orden : 'Error: '+p.message);
        if(p.status==='success'){
          localStorage.removeItem('cart');
          renderCart();
        }
      });
    });

    gsap.registerPlugin(ScrollTrigger);
    gsap.utils.toArray("section .section-title").forEach(title=>{
      gsap.from(title,{y:50,opacity:0,duration:0.8,ease:"power3.out",scrollTrigger:{trigger:title,start:"top 80%"}});
    });
  })();
  </script>
</body>
</html>
